(()=>{var e={};e.id=597,e.ids=[597],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9018:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>b,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>A});var s={};t.r(s),t.d(s,{POST:()=>u});var o=t(6559),a=t(8088),n=t(7719),i=t(2190);let c="patAyhGbJFTVsTTkf.6da6ef653137d7e483aa9f743ff517ef79e090dfba8e8f86ddbd266a4ea18c71",l="https://api.airtable.com/v0/appnhPWwfx1nd35tg/tblUmqoOAay60aQ75";async function u(e){try{let r=await e.json();console.log("Request body received:",r);let{customerInfo:t,orderItems:s,orderItemsString:o,totalAmount:a}=r;if(!t||!s||!Array.isArray(s)||0===s.length)return i.NextResponse.json({error:"유효하지 않은 주문 정보입니다."},{status:400});let n={Authorization:`Bearer ${c}`,"Content-Type":"application/json"},u=[{fields:{SchoolName:t.school,ContactName:t.name,PhoneNumber:t.phone,Email:t.email,AdditionalInfo:t.additionalInfo||"",OrderItems:o||s.map(e=>`${e.product||e.name} ${e.plan?`(${e.plan})`:""} x${e.quantity}`).join(", "),TotalAmount:a,OrderDate:new Date().toISOString()}}];console.log("Sending to Airtable:",{url:l,headers:{...n,Authorization:"Bearer [REDACTED]"},records:u});try{let e,r=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({records:u})});console.log(`Airtable API response status: ${r.status} ${r.statusText}`);let t={};if(r.headers.forEach((e,r)=>{t[r]=e}),console.log("Airtable API response headers:",t),!r.ok){let e,t=await r.text();console.error("Airtable API error response text:",t);try{e=JSON.parse(t),console.error("Airtable API error parsed:",e)}catch(r){console.error("Failed to parse Airtable error response:",r),e={text:t}}let s="Airtable API 오류가 발생했습니다.";return 401===r.status||403===r.status?s="Airtable 인증 오류: 토큰이 유효하지 않거나 권한이 부족합니다.":422===r.status?s="Airtable 데이터 검증 오류: 필드 이름이나 데이터 형식이 올바르지 않습니다.":429===r.status?s="Airtable API 요청 한도 초과: 잠시 후 다시 시도해주세요.":r.status>=500&&(s="Airtable 서버 오류: 잠시 후 다시 시도해주세요."),i.NextResponse.json({error:s,details:e,status:r.status,statusText:r.statusText},{status:500})}let s=await r.text();console.log("Airtable API success response:",s);try{e=JSON.parse(s)}catch(r){console.error("Failed to parse Airtable success response:",r),e={text:s}}return console.log("Airtable API success parsed:",e),i.NextResponse.json({success:!0,message:"주문이 성공적으로 접수되었습니다.",data:e})}catch(r){console.error("Airtable fetch error:",{error:r,message:r instanceof Error?r.message:String(r),code:r.code});let e="Airtable API 호출 중 오류가 발생했습니다.";return"ECONNREFUSED"===r.code?e="Airtable 서버에 연결할 수 없습니다. 네트워크 연결을 확인해주세요.":"ETIMEDOUT"===r.code&&(e="Airtable 서버 연결 시간이 초과되었습니다."),i.NextResponse.json({error:e,details:r instanceof Error?r.message:String(r),code:r.code,success:!1},{status:500})}}catch(r){console.error("Detailed order submission error:",{error:r,message:r instanceof Error?r.message:r,stack:r instanceof Error?r.stack:null,name:r instanceof Error?r.name:"Unknown",code:r.code,cause:r.cause});let e="주문 처리 중 오류가 발생했습니다. 다시 시도해주세요.";return"ECONNREFUSED"===r.code?e="Airtable 서버에 연결할 수 없습니다. 네트워크 연결을 확인해주세요.":"ETIMEDOUT"===r.code&&(e="Airtable 서버 연결 시간이 초과되었습니다. 다시 시도해주세요."),i.NextResponse.json({error:e,details:r instanceof Error?r.message:r,code:r.code,name:r instanceof Error?r.name:"Unknown",stack:r instanceof Error?r.stack:null,success:!1},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/submit-order/route",pathname:"/api/submit-order",filename:"route",bundlePath:"app/api/submit-order/route"},resolvedPagePath:"/Users/contenjoo/Desktop/Project/learntoday newversion/src/app/api/submit-order/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:A,serverHooks:m}=d;function b(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:A})}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580],()=>t(9018));module.exports=s})();